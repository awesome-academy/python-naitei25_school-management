{% extends "students/base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Attendance" %} - CollegeERP{% endblock title %}

{% block content %}
<div class="card mb-3">
  <div class="card-header">
    <i class="fas fa-table"></i>
    <b>{% trans "Attendance Summary" %} - {{ student.name }}</b>
    <br />
    <small class="text-muted">
      {% trans "Class" %}: {{ student_class }} |
      {% trans "Total Subjects" %}: {{ attendance_data|length }}
    </small>
  </div>

  <div class="card-body">
    <form method="get" class="mb-3">
      <div class="row g-2">
        <div class="col-md-3">
          <select name="academic_year" class="form-control">
            <option value="">{% trans "All years" %}</option>
            {% for y in academic_years %}
              <option value="{{ y }}" {% if selected_year == y %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <select name="semester" class="form-control">
            <option value="">{% trans "All semesters" %}</option>
            {% for s in available_semesters %}
              <option value="{{ s }}" {% if selected_semester|stringformat:'s' == s|stringformat:'s' %}selected{% endif %}>{{ s }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">{% trans "Filter" %}</button>
        </div>
      </div>
    </form>
    <div class="table-responsive">
      <table class="table table-bordered text-center" id="dataTable" width="100%" cellspacing="0">
        <thead class="table-light">
          <tr>
            <th scope="col">{% trans "Course ID" %}</th>
            <th scope="col">{% trans "Course name" %}</th>
            <th scope="col">{% trans "Teacher" %}</th>
            <th scope="col">{% trans "Attended classes" %}</th>
            <th scope="col">{% trans "Total classes" %}</th>
            <th scope="col">{% trans "Attendance %" %}</th>
            <th scope="col">{% trans "Classes to attend" %}</th>
            <th scope="col">{% trans "Actions" %}</th>
          </tr>
        </thead>

        <tbody>
          {% for data in attendance_data %}
          <tr>
            <td>{{ data.subject.id }}</td>
            <td>
              <a
                href="{% url 'students:attendance_detail' student.USN data.subject.id %}"
                class="text-decoration-none"
              >
                {{ data.subject.name }}
              </a>
            </td>
            <td><small>{{ data.teacher.name }}</small></td>
            <td>{{ data.attended_classes }}</td>
            <td>{{ data.total_classes }}</td>

            {% if data.attendance_percentage < 75 %}
              <td class="p-3 mb-2 bg-danger text-white">{{ data.attendance_percentage }}%</td>
            {% else %}
              <td class="p-3 mb-2 bg-success text-white">{{ data.attendance_percentage }}%</td>
            {% endif %}

            <td>{{ data.classes_to_attend }}</td>
            <td>
              <a
                href="{% url 'students:attendance_detail' student.USN data.subject.id %}"
                class="btn btn-primary btn-sm"
              >
                <i class="fas fa-eye"></i> {% trans "View Details" %}
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8">
              {% trans "No subjects assigned to your class yet" %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock content %}
